api:
  enabled: true
  listen_address: 0.0.0.0
  port: 8080
attributes:
  destination:
    k8s:
      association:
        endpoint:
          sources:
            - from: flow
              name: destination.ip
              to:
                - subsets[*].addresses[*].ip
            - from: flow
              name: destination.port
              to:
                - subsets[*].ports[*].port
            - from: flow
              name: network.transport
              to:
                - subsets[*].ports[*].protocol
        endpointslice:
          sources:
            - from: flow
              name: destination.ip
              to:
                - endpoints[*].addresses[*]
            - from: flow
              name: destination.port
              to:
                - ports[*].port
            - from: flow
              name: network.transport
              to:
                - ports[*].protocol
        gateway:
          sources:
            - from: flow
              name: destination.ip
              to:
                - spec.addresses[*].value
                - status.addresses[*].value
            - from: flow
              name: destination.port
              to:
                - spec.listeners[*].port
        ingress:
          sources:
            - from: flow
              name: destination.ip
              to:
                - status.loadBalancer.ingress[*].ip
                - status.loadBalancer.ingress[*].hostname
            - from: flow
              name: destination.port
              to:
                - spec.defaultBackend.service.port
                - spec.rules[*].http.paths[*].backend.service.port.number
        networkpolicy:
          sources:
            - from: flow
              name: destination.ip
              to:
                - spec.ingress[*].from[*].ipBlock.cidr
                - spec.egress[*].to[*].ipBlock.cidr
            - from: flow
              name: destination.port
              to:
                - spec.ingress[*].ports[*].port
                - spec.egress[*].ports[*].port
            - from: flow
              name: network.transport
              to:
                - spec.ingress[*].ports[*].protocol
                - spec.egress[*].ports[*].protocol
        node:
          sources:
            - from: flow
              name: destination.ip
              to:
                - status.addresses[*].address
        pod:
          sources:
            - from: flow
              name: destination.ip
              to:
                - status.podIP
                - status.podIPs[*]
                - status.hostIP
                - status.hostIPs[*]
            - from: flow
              name: destination.port
              to:
                - spec.containers[*].ports[*].containerPort
                - spec.containers[*].ports[*].hostPort
            - from: flow
              name: network.transport
              to:
                - spec.containers[*].ports[*].protocol
        service:
          sources:
            - from: flow
              name: destination.ip
              to:
                - spec.clusterIP
                - spec.clusterIPs[*]
                - spec.externalIPs[*]
                - spec.loadBalancerIP
                - spec.externalName
            - from: flow
              name: destination.port
              to:
                - spec.ports[*].port
            - from: flow
              name: network.transport
              to:
                - spec.ports[*].protocol
            - from: flow
              name: network.type
              to:
                - spec.ipFamilies[*]
      extract:
        metadata:
          - "[*].metadata.name"
          - "[*].metadata.namespace"
          - pod.metadata.uid
  source:
    k8s:
      association:
        endpoint:
          sources:
            - from: flow
              name: source.ip
              to:
                - subsets[*].addresses[*].ip
            - from: flow
              name: source.port
              to:
                - subsets[*].ports[*].port
            - from: flow
              name: network.transport
              to:
                - subsets[*].ports[*].protocol
        endpointslice:
          sources:
            - from: flow
              name: source.ip
              to:
                - endpoints[*].addresses[*]
            - from: flow
              name: source.port
              to:
                - ports[*].port
            - from: flow
              name: network.transport
              to:
                - ports[*].protocol
            - from: flow
              name: network.type
              to:
                - addressType
        gateway:
          sources:
            - from: flow
              name: source.ip
              to:
                - spec.addresses[*].value
                - status.addresses[*].value
            - from: flow
              name: source.port
              to:
                - spec.listeners[*].port
        ingress:
          sources:
            - from: flow
              name: source.ip
              to:
                - status.loadBalancer.ingress[*].ip
                - status.loadBalancer.ingress[*].hostname
            - from: flow
              name: source.port
              to:
                - spec.defaultBackend.service.port
                - spec.rules[*].http.paths[*].backend.service.port.number
        networkpolicy:
          sources:
            - from: flow
              name: source.ip
              to:
                - spec.ingress[*].from[*].ipBlock.cidr
                - spec.egress[*].to[*].ipBlock.cidr
            - from: flow
              name: source.port
              to:
                - spec.ingress[*].ports[*].port
                - spec.egress[*].ports[*].port
            - from: flow
              name: network.transport
              to:
                - spec.ingress[*].ports[*].protocol
                - spec.egress[*].ports[*].protocol
        node:
          sources:
            - from: flow
              name: source.ip
              to:
                - status.addresses[*].address
        pod:
          sources:
            - from: flow
              name: source.ip
              to:
                - status.podIP
                - status.podIPs[*]
                - status.hostIP
                - status.hostIPs[*]
            - from: flow
              name: source.port
              to:
                - spec.containers[*].ports[*].containerPort
                - spec.containers[*].ports[*].hostPort
            - from: flow
              name: network.transport
              to:
                - spec.containers[*].ports[*].protocol
        service:
          sources:
            - from: flow
              name: source.ip
              to:
                - spec.clusterIP
                - spec.clusterIPs[*]
                - spec.externalIPs[*]
                - spec.loadBalancerIP
                - spec.externalName
            - from: flow
              name: source.port
              to:
                - spec.ports[*].port
            - from: flow
              name: network.transport
              to:
                - spec.ports[*].protocol
            - from: flow
              name: network.type
              to:
                - spec.ipFamilies[*]
      extract:
        metadata:
          - "[*].metadata.name"
          - "[*].metadata.namespace"
          - "[*].metadata.uid"
auto_reload: false
discovery:
  informer:
    k8s:
      owner_relations:
        exclude_kinds:
          - EndpointSlice
        include_kinds:
          - Service
        max_depth: 5
      selector_relations:
        - kind: NetworkPolicy
          selector_match_expressions_field: spec.podSelector.matchExpressions
          selector_match_labels_field: spec.podSelector.matchLabels
          to: Pod
        - kind: Service
          selector_match_labels_field: spec.selector
          to: Pod
      selectors:
        - kind: Service
        - kind: Endpoint
        - kind: EndpointSlice
        - kind: Gateway
        - kind: Ingress
        - kind: Pod
        - kind: ReplicaSet
        - kind: Deployment
        - kind: Daemonset
        - kind: StatefulSet
        - kind: Job
        - kind: CronJob
        - kind: NetworkPolicy
  instrument:
    interfaces:
      - eth0
export:
  traces:
    otlp:
      auth:
        basic:
          pass: PASSWORD
          user: USERNAME
      endpoint: http://otelcol:4317
      protocol: grpc
      timeout: 10s
      max_batch_size: 512
      max_batch_interval: 5s
      max_queue_size: 2048
      max_concurrent_exports: 1
      max_export_timeout: 30s
      tls:
        ca_cert: /etc/certs/ca.crt
        client_cert: /etc/certs/cert.crt
        client_key: /etc/certs/cert.key
        insecure_skip_verify: false
    stdout: ""
filter:
  destination:
    address:
      match: ""
      not_match: ""
    port:
      match: ""
      not_match: ""
  flow:
    connection_state:
      match: ""
      not_match: ""
    end_reason:
      match: "" # e.g., "end_of_flow_detected"
      not_match: ""
    ip_dscp_name:
      match: "" # e.g., "ef, af11" (Expedited Forwarding, Assured Forwarding)
      not_match: ""
    ip_ecn_name:
      match: "" # e.g., "ce" (Congestion Experienced)
      not_match: ""
    ip_ttl:
      match: "" # e.g., "64, 128"
      not_match: ""
    ip_flow_label:
      match: "" # e.g., "1000-2000"
      not_match: ""
    icmp_type_name:
      match: "" # e.g., "echo_request, echo_reply"
      not_match: ""
    icmp_code_name:
      match: "" # e.g., "port_unreachable"
      not_match: ""
    tcp_flags:
      match: "" # e.g., "syn, ack"
      not_match: ""
  network:
    transport:
      match: ""
      not_match: ""
    type:
      match: ""
      not_match: ""
    interface_name:
      match: "" # e.g., "eth*, lo"
      not_match: ""
    interface_index:
      match: "" # e.g., "1, 2"
      not_match: ""
    interface_mac:
      match: "" # e.g., "00:1b:44:*:*:*"
      not_match: ""
  source:
    address:
      match: ""
      not_match: ""
    port:
      match: ""
      not_match: ""
informer:
  k8s:
    informers_sync_timeout: 30s
    kubeconfig_path: ""
internal:
  traces:
    otlp:
      auth:
        basic:
          pass: PASSWORD
          user: USERNAME
      endpoint: http://otelcol:4317
      protocol: grpc
      timeout: 10s
      max_batch_size: 512
      max_batch_interval: 5s
      max_queue_size: 2048
      max_concurrent_exports: 1
      max_export_timeout: 30s
      tls:
        ca_cert: /etc/certs/ca.crt
        client_cert: /etc/certs/cert.crt
        client_key: /etc/certs/cert.key
        insecure_skip_verify: false
    span_format: full
    stdout:
      format: "text_indent" # text, text_indent(*new), json, json_indent
log_level: info
metrics:
  enabled: true
  listen_address: 0.0.0.0
  port: 10250
pipeline:
  ring_buffer_capacity: 8192
  worker_count: 4
  worker_poll_interval: 5s
  k8s_decorator_threads: 12
  flow_span_channel_multiplier: 2.0
  decorated_span_channel_multiplier: 4.0
parser:
  geneve_port: 6081
  vxlan_port: 4789
  wireguard_port: 51820
shutdown_timeout: 5s
span:
  generic_timeout: 30s
  icmp_timeout: 10s
  max_record_interval: 60s
  tcp_fin_timeout: 5s
  tcp_rst_timeout: 5s
  tcp_timeout: 20s
  udp_timeout: 60s
  community_id_seed: 0
  enable_hostname_resolution: true
  hostname_resolve_timeout: 100ms
